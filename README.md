# Домашнее задание по курсу открытой школы "Холдинг Т1"
## Реализация системы мониторинга с использованием Spring Kafka (Producer)

### Что было сделано
1. Написан Kafka Producer для отправки метрик по кафке.
2. Написан механизм создания топиков на основе Spring KafkaAdmin. Альтернативно можно создавать топики через CLI, либо написать отдельный сервис для поднятия топиков.
3. Kafka поднимается с через docker-compose с Kafka Raft. Также поднимается Kafka UI для удобного мониторинга кафки.
4. Написан KafkaMetricRegistry на основе библиотеки Micrometer. Данный Registry снимает метрики типа Gauge и Counter и отправляет их по Kafka. Сделано для демонстрации работы системы. Используются метрики по-умолчанию, предоставляемые Spring Actuator.
5. Написан ServiceInfoProvider для получения имени и экземпляра сервиса. Необходимо для демонстрации работы KafkaMetricRegistry.
6. Написан REST API для добавления метрик и отправки их по кафке.
7. Добавлена валидация сущностей на уровне контроллера.
8. Добавлены модульные тесты на основе SpringBootTest и TestContainers.
9. Добавлен swagger-ui для описания контрактов API.

### How-to
1. Для того чтобы поднять сервис требуется наличие Java 17 и Docker на целевой системе.
2. Убедиться, что порт 8085 доступен и не занят другими сервисами. Порт можно сменить в `application.properties`.
3. Убедиться, что порт 9092 доступен и не занят другими сервисами. Порт можно сменить в `compose.yaml` для сервиса `kafka0` в директиве `ports`.
4. Убедиться, что порт 8081 доступен и не занят другими сервисами. Порт можно сменить в `compose.yaml` для сервиса `kafka-ui` в директиве `ports`.
5. Выполнить команду ```./gradlew bootRun``` в командной строке
6. Перейти в браузере по адресу `http://localhost:8085/swagger-ui`
7. С помощью swagger-ui выполнить метод `/metrics` и добавить метрику.
8. Перейти в браузере по адресу `http://localhost:8081` и перейти в раздел `Topics`, зайти в топик `metrics-topic` и найти добавленную метрику. Также, периодически, KafkaMetricRegistry будет отправлять метрики текущего сервиса в этот же топик от имени этого сервиса.
9. Развернуть сервис консьюмер для анализа метрик. [kafka-metrics-consumer](https://github.com/Helen-digger/KafkaMetricsConsumer)
10. Тесты можно запустить с помощью команды ```./gradlew test```